<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>Material Design for Bootstrap</title>
    <link rel="icon" href="./img/ueau-favicon2.ico" type="image/x-icon" />

    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.11.2/css/all.css"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"
    />
    <link rel="stylesheet" href="css/mdb.min.css" />
    <link rel="stylesheet" href="./css/compiled.min.css" />
    <link rel="stylesheet" href="css/style.css" />
    <style></style>
    <script
      src="https://code.jquery.com/jquery-3.6.0.min.js"
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
      crossorigin="anonymous"
    ></script>
    <script>
      $(function () {
        $("#header").load("./header.html");
        $("#footer").load("./footer.html");
      });
    </script>
  </head>
  <body>
    <header id="header"></header>
    <main>
      <div class="container-fluid vh-100">
        <div class="h-100 d-flex flex-column justify-content-start">
          <div class="align-self-center mb-5 pt-3">
            <img
              id="logo"
              class="img-fluid"
              src="./img/uaeu-logo.png"
              alt="United Arab Emirates University Logo"
            />
          </div>
          <div class="mb-3 text-black">
            <h1 class="font-weight-bold">Dashboard</h1>
          </div>

          <div id="students-list">
            <table class="table table-responsive table-hover">
              <thead class="datatable-header">
                <th>#</th>
                <th>S.No.</th>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Reviewed</th>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </main>

    <footer id="footer"></footer>
    <!-- Button trigger modal -->
    <!-- <button
      type="button"
      class="btn btn-primary"
      data-toggle="modal"
      data-target="#alpha-test-modal"
    >
      alphaTest
    </button> -->
    <!-- Button trigger modal -->
    <!-- <button
      type="button"
      class="btn btn-primary"
      data-toggle="modal"
      data-target="#ghq-modal"
    >
      GHQ
    </button> -->
    <!-- Alpha Test Modal -->
    <div
      class="modal fade"
      id="alpha-test-modal"
      tabindex="-1"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Alpha Test</h5>
            <button
              type="button"
              class="btn-close"
              data-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div id="alpha-test-chart" class="m-auto"></div>
            <div id="alphatest"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- GHQ Modal -->
    <div
      class="modal fade"
      id="ghq-modal"
      tabindex="-1"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
            <button
              type="button"
              class="btn-close"
              data-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div id="checklist-chart"></div>
            <div id="checklist"></div>
          </div>
        </div>
      </div>
    </div>
  </body>
  <!-- MDB JavaScript -->
  <script type="text/javascript" src="js/mdb.min.js"></script>
  <!-- <script src="https://cdn.jsdelivr.net/npm/form2js@1.0.0/src/form2js.js"></script> -->
  <script
    src="https://cdn.jsdelivr.net/npm/form2js@1.0.0/src/js2form.js"
    integrity="sha256-jqAXOHx2o5QjrSkBIbN3QXYkCVpo5cWAuARDjnnpMpE="
    crossorigin="anonymous"
  ></script>
  <!-- Custom scripts -->
  <script src="./js/scripts.js"></script>
  <script src="./js/student-surveys.js"></script>
  <script type="text/javascript">
    let studentList = "";
    let user = JSON.parse(sessionStorage.getItem("user"));
    console.log(user);
    studentList = `
                <tr>
                  <td>
                    <button
                        type="button"
                        class="btn btn-outline-dark btn-sm btn-floating"
                        data-toggle="collapse"
                        data-target="#${user.full_name.split(" ").join("")}"
                        aria-expanded="true"
                        aria-controls="${user.full_name.split(" ").join("")}">
                      <i class="fas fa-caret-right"></i>
                    </button>
                  </td>
                  <td>1</td>
                  <td>${user.full_name}</td>
                  <td>${user.email}</td>
                  <td>${user.phone_number}</td>
                  <td><span class="btn btn-warning btn-sm">Pending</span></td>
                  </tr>
                  <tr id="${user.full_name
                    .split(" ")
                    .join("")}" class="collapse mt-3">
                    <td colspan="6">
                    <button id="alpha-test-show" class="btn btn-outline-primary">Alpha Test</button>
                    <button id="ghq-show" class="btn btn-primary d-none">GHQ</button>
                    </td>
                  </tr>
      `;
    $("#students-list table tbody").html(studentList);
    // new Datatable(element, data, {sm: true})
    const alphaTestModal = new mdb.Modal(
      document.getElementById("alpha-test-modal"),
      {}
    );
    const ghqModal = new mdb.Modal(document.getElementById("ghq-modal"), {});
    $("#alpha-test-show").on("click", (e) => {
      renderSurvey(student_alpha_test, "alphatest", true);
      let alphatest_data = JSON.parse(sessionStorage.getItem("alphatest"));
      js2form("alphatest", alphatest_data);
      let yes = 0;
      let no = 0;
      for (key in alphatest_data) {
        alphatest_data[key] == "yes" ? yes++ : no++;
      }
      // console.log("yes no ", yes, no);
      let chartData = {
        type: "pie",
        data: {
          labels: ["Yes", "No"],
          datasets: [
            {
              data: [yes, no],
              backgroundColor: ["rgba(34,102,211,0.6)", "rgba(240,36,36,0.6)"],
            },
          ],
        },
      };
      new mdb.Chart($("#alpha-test-modal #alpha-test-chart")[0], chartData);
      alphaTestModal.show();
    });
    $("#ghq-show").on("click", (e) => {
      renderSurvey(student_checklist, "checklist", true);
      let checklist_data = JSON.parse(sessionStorage.getItem("checklist"));
      js2form("checklist", checklist_data);
      ghqModal.show();
    });
  </script>
</html>
